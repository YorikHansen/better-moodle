name: 🏗 Build

inputs:
    config:
        description: The config to build with
        required: true

runs:
    using: composite
    steps:
        - name: 🎛️ setup
          uses: ./.github/actions/setup

        - name: 🏗️ build Better-Moodle for ${{ inputs.config }}
          run: yarn build ${{ inputs.config }}

        # unfortunately, GitHub Actions don't allow env being set via env key in composite actions, so we need this workaround here
        - name: 🌳 set env
          run: |
              echo "DIST_DIR=dist" >> $GITHUB_ENV
              echo "DIST_FILE=better-moodle-${{ inputs.config }}.user.js" >> $GITHUB_ENV
          shell: bash

        - name: 📤️ upload build
          id: upload
          uses: actions/upload-artifact@v4
          with:
              name: ${{ env.dist_file }}
              path: ${{ env.dist_dir }}/${{ env.dist_file }}
    outputs:
        digest: ${{ steps.upload.outputs.artifact-digest }}
        file: ${{ env.dist_file }}
        dir: ${{ env.dist_dir }}
