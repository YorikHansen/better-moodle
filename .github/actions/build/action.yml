name: üèó Build

inputs:
    config:
        description: The config to build with
        required: true

runs:
    using: composite
    steps:
        - name: üéõÔ∏è setup
          uses: ./.github/actions/setup

        - name: üèóÔ∏è build Better-Moodle for ${{ inputs.config }}
          run: yarn build ${{ inputs.config }}
          shell: bash

        # unfortunately, GitHub Actions don't allow env being set via env key in composite actions, so we need this workaround here
        - name: üå≥ set env
          run: |
              echo "DIST_DIR=dist" >> $GITHUB_ENV
              echo "DIST_FILE=better-moodle-${{ inputs.config }}.user.js" >> $GITHUB_ENV
          shell: bash

        - name: üì§Ô∏è upload build
          id: upload
          uses: actions/upload-artifact@v4
          with:
              name: ${{ env.dist_file }}
              path: ${{ env.dist_dir }}/${{ env.dist_file }}

outputs:
    digest:
        description: The digest of the uploaded artifact
        value: ${{ steps.upload.outputs.artifact-digest }}
    file:
        description: The filename of the built userscript
        value: ${{ env.dist_file }}
    dir:
        description: The directory, output files live in
        value: ${{ env.dist_dir }}
